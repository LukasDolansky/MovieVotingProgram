<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
    async function getData(category, year, isWinner) {
    console.log("entering getData()");
    const apiBase = 'http://localhost:3000/api/sort/?';
    var thisCategory = '';
    var thisYear = '';
    var thisIsWinner = '';
  
    if(category != undefined) {
      thisCategory = 'category=' + category + '&';
    }
    if(year != undefined) {
      thisYear = 'year=' + year + '&';
    }
    if(isWinner != undefined) {
      thisIsWinner = 'winner' + isWinner;
    }
  
    var apiURL = apiBase + thisCategory + thisYear + thisIsWinner;
    
    var testData = await fetch(apiURL)
    .then(async testData => {
      testData = await testData.json();
      console.log(testData);
      return testData;
    });
    return testData;
    } 
function setupWebPage(){
  setTitle();
  getInformation();
}
function setTitle(){
  var urlSearchParams = new URLSearchParams(window.location.search);
  var category = urlSearchParams.get('category');
  var webHeader = document.createElement('h1');
  webHeader.textContent = category;
  document.getElementsByTagName('body')[0].appendChild(webHeader);
  
}
async function getInformation(){
    var urlSearchParams = new URLSearchParams(window.location.search);
    var category; // = urlSearchParams.get('category');
    var year;  //= urlSearchParams.get('year');
    var winner; // = urlSearchParams.get('winner');
    if( urlSearchParams.get('category') != null){
      category = urlSearchParams.get('category');
    }
    if(urlSearchParams.get('year') != null){
      year = urlSearchParams.get('year');
    }
    if(urlSearchParams.get('winner') != null){
      winner = urlSearchParams.get('winner');
    }
    movieListContainer = document.createElement('div');
    document.getElementsByTagName('body')[0].appendChild(movieListContainer);
  
    var movieData = await getData(category, year, winner);
    console.log("outside getData()");
    console.log(movieData);
    console.log(Object.keys(movieData).length);
    console.log(movieData[0]);
    console.log(movieData[2].description)
    //This while loop goes through the api data and put them in html elements
    var k = 1;
    var index = 0;
    while(k <= Object.keys(movieData).length){
      console.log(movieData[k] != undefined);
      if(movieData[index] != undefined){
        var title = document.createElement('h2');
        var poster = document.createElement('img');
        var movieLink = document.createElement('a');
        var description = document.createElement('p');
      
        //insert data into html elements
        title.textContent = movieData[index].title;
        poster.setAttribute('src', movieData[index].posterURL);
        poster.setAttribute('height', 370);
        poster.setAttribute('width', 250);
        movieLink.textContent = movieData[index].imdbLink;
        movieLink.setAttribute('href', movieData[index].imdbLink)
        description.textContent = movieData[index].description;
  
  
  
        movieListContainer.appendChild(title);
        movieListContainer.appendChild(poster);
        movieListContainer.appendChild(document.createElement('br'));
        movieListContainer.appendChild(movieLink);
        movieListContainer.appendChild(document.createElement('br'));
        movieListContainer.appendChild(description);
        movieListContainer.appendChild(document.createElement('br'));
        k++;
      }
      index = index + 1;
    }
  /*
    for(i = 0; i < movieData.length; ++i){
      title = document.createElement('p');
      poster = document.createElement('img');
      movieLink = document.createElement('a');
      description = document.createElement('p');
      
      //insert data into html elements
      title.textContent = data[i].title;
      poster.setAttribute('src', data.posterURL);
      movieLink.textContent = data[i].imdbLink;
      movieLink.setAttribute('href', data[i].imdbLink)
      description.textContent =data[i].description;
  
  
  
      movieListContainer.appendChild(title);
      movieListContainer.appendChild(poster);
      movieListContainer.appendChild(movieLink);
      movieListContainer.appendChild(description);
    }*/
    
  
}
    </script>
    <!--<script src = "/results.js"></script>-->
    <meta charset="UTF-8" />
    <meta http-equiv="x-UA-Cmpatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, inital-scale=1.0" />
    <!--IMPORTED FONTS-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"
      rel="stylesheet"
    />
    <link href="/style.css" rel="stylesheet" type="text/css" />

    <title>Results Page</title>
  </head>
  <body onload="setupWebPage()">
    <nav class="Xnavbar">
      <div class="Xnav__container">
        <h1 id="Xnavbar-logo">MOVIE VOTING SYSTEM /RESULTS</h1>
        <div class="Xnavbar__btn">
          <a class="button" href="/" id="signup">HOME</a>
          <button onclick="setupWebPage()">press</button>

        </div>
      </div>
    </nav>
  </body>
</html>
